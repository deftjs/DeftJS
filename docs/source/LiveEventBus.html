<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">// Generated by CoffeeScript 1.4.0
/*
Copyright (c) 2012 [DeftJS Framework Contributors](http://deftjs.org)
Open source under the [MIT License](http://en.wikipedia.org/wiki/MIT_License).
*/

<span id='Deft-event-LiveEventBus'>/**
</span>* Event bus for live component selectors.
*/

Ext.define('Deft.event.LiveEventBus', {
  alternateClassName: ['Deft.LiveEventBus'],
  requires: ['Ext.Component', 'Ext.ComponentManager', 'Deft.event.LiveEventListener'],
  singleton: true,
<span id='Deft-event-LiveEventBus-method-constructor'>  constructor: function() {
</span>    this.listeners = [];
  },
<span id='Deft-event-LiveEventBus-method-destroy'>  destroy: function() {
</span>    var listener, _i, _len, _ref;
    _ref = this.listeners;
    for (_i = 0, _len = _ref.length; _i &lt; _len; _i++) {
      listener = _ref[_i];
      listener.destroy();
    }
    this.listeners = null;
  },
<span id='Deft-event-LiveEventBus-method-addListener'>  addListener: function(container, selector, eventName, fn, scope, options) {
</span>    var listener;
    listener = Ext.create('Deft.event.LiveEventListener', {
      container: container,
      selector: selector,
      eventName: eventName,
      fn: fn,
      scope: scope,
      options: options
    });
    this.listeners.push(listener);
  },
<span id='Deft-event-LiveEventBus-method-removeListener'>  removeListener: function(container, selector, eventName, fn, scope) {
</span>    var listener;
    listener = this.findListener(container, selector, eventName, fn, scope);
    if (listener != null) {
      Ext.Array.remove(this.listeners, listener);
      listener.destroy();
    }
  },
<span id='Deft-event-LiveEventBus-method-on'>  on: function(container, selector, eventName, fn, scope, options) {
</span>    return this.addListener(container, selector, eventName, fn, scope, options);
  },
<span id='Deft-event-LiveEventBus-method-un'>  un: function(container, selector, eventName, fn, scope) {
</span>    return this.removeListener(container, selector, eventName, fn, scope);
  },
<span id='Deft-event-LiveEventBus-method-findListener'>  findListener: function(container, selector, eventName, fn, scope) {
</span>    var listener, _i, _len, _ref;
    _ref = this.listeners;
    for (_i = 0, _len = _ref.length; _i &lt; _len; _i++) {
      listener = _ref[_i];
      if (listener.container === container &amp;&amp; listener.selector === selector &amp;&amp; listener.eventName === eventName &amp;&amp; listener.fn === fn &amp;&amp; listener.scope === scope) {
        return listener;
      }
    }
    return null;
  },
<span id='Deft-event-LiveEventBus-method-register'>  register: function(component) {
</span>    component.on('added', this.onComponentAdded, this);
    component.on('removed', this.onComponentRemoved, this);
  },
<span id='Deft-event-LiveEventBus-method-unregister'>  unregister: function(component) {
</span>    component.un('added', this.onComponentAdded, this);
    component.un('removed', this.onComponentRemoved, this);
  },
<span id='Deft-event-LiveEventBus-method-onComponentAdded'>  onComponentAdded: function(component, container, eOpts) {
</span>    var listener, _i, _len, _ref;
    _ref = this.listeners;
    for (_i = 0, _len = _ref.length; _i &lt; _len; _i++) {
      listener = _ref[_i];
      listener.register(component);
    }
  },
<span id='Deft-event-LiveEventBus-method-onComponentRemoved'>  onComponentRemoved: function(component, container, eOpts) {
</span>    var listener, _i, _len, _ref;
    _ref = this.listeners;
    for (_i = 0, _len = _ref.length; _i &lt; _len; _i++) {
      listener = _ref[_i];
      listener.unregister(component);
    }
  }
}, function() {
  if (Ext.getVersion('touch') != null) {
    Ext.define('Deft.Component', {
      override: 'Ext.Component',
      setParent: function(newParent) {
        var oldParent, result;
        oldParent = this.getParent();
        result = this.callParent(arguments);
        if (oldParent === null &amp;&amp; newParent !== null) {
          this.fireEvent('added', this, newParent);
        } else if (oldParent !== null &amp;&amp; newParent !== null) {
          this.fireEvent('removed', this, oldParent);
          this.fireEvent('added', this, newParent);
        } else if (oldParent !== null &amp;&amp; newParent === null) {
          this.fireEvent('removed', this, oldParent);
        }
        return result;
      },
      isDescendantOf: function(container) {
        var ancestor;
        ancestor = this.getParent();
        while (ancestor != null) {
          if (ancestor === container) {
            return true;
          }
          ancestor = ancestor.getParent();
        }
        return false;
      }
    });
  }
  Ext.Function.interceptAfter(Ext.ComponentManager, 'register', function(component) {
    Deft.event.LiveEventBus.register(component);
  });
  Ext.Function.interceptAfter(Ext.ComponentManager, 'unregister', function(component) {
    Deft.event.LiveEventBus.unregister(component);
  });
});
</pre>
</body>
</html>
